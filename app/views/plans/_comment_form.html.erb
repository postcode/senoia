<% comments = plan.root_comments.open.element("#{title}_comment_text") %>
<% if (plan.persisted? && can?(:create, plan.comments.build)) || comments.any? %>
  <div id="<%= title %>_comment" class="comment-section">
    <% if can? :edit, plan %>
      <a href="#" class="comment"><i class="fi-plus"></i> COMMENT</a>
      <div class="new-comment-area" data-url="<%= url_for([ plan, :comments, element_id: "#{title}_comment_text" ]) %>">
        <%= text_area_tag "comment[body]", "", id: "#{title}_comment_text", cols: 10, rows: 5 %>
        <%= link_to "SUBMIT", "javascript:void(0);", class: "new-comment button warning tiny radius" %>
      </div>
    <% end %>
    <div class="existing-comments">
      <%= render partial: "comments/comment", collection: comments %>
    </div>
  </div>
<% end %>
